<% include ./partials/navbar %>
<% include ./partials/footer %>
<% include ./partials/messages %>
<p id ="parentId"><%=parentAssetId %></p>
<link rel="stylesheet" href="/stylesheets/table-sortable.css">
<script src="/scripts/table-sortable.js" ></script>

<h3 style="text-align: center; margin-top: 20px;">Approval</h3>
<div class="container">
    <div class="row mt-5 mb-3 align-items-center">
        <div class="col-md-5">
          <a class="btn btn-primary btn-md bg-gray" href="/procurement/assetRequisitionViewRel/<%=parentAssetId %>" >Go To Asset Requisition </a>
          <!--   <a class="btn btn-primary btn-md bg-gray" href="#" id="">Create New Non It Procurement</a> -->
            <!-- <a class="btn btn-primary btn-md bg-gray" href="/procurement/getNonItProcurementListVIew/" >Refresh</a> -->
        </div>
        <div class="col-md-3">
        <input type="text" class="form-control" placeholder="Search" id="searchField" style="margin-top: 5px;">
        </div>
        <div class="col-md-2 text-right">
        <span class="pr-2">Rows Per Page:</span>
        </div>
        <div class="col-md-1">
            <div class="d-flex justify-content-end">
                <select class="custom-select" name="rowsPerPage" id="changeRows">
                    <option value="5">5</option>
                    <option value="10">10</option>
                    <option value="15" selected>15</option>
                </select>
            </div>
        </div>
 </div>
 <div id="approvalTable" class="responsive ">

</div>

</div>
<script>


    $(document).ready(function(){
      $('#parentId').hide();
       

        let parentId=document.getElementById('parentId').innerHTML;
       // alert('parentId '+parentId);
    
        /**************Table Sortable Start ***********/
    
            let columns ={
                sequence : 'Sequence',
                name: 'Name',
                type : 'Type',
                status:'Status',
                app_email: 'Approver Emails',             
            }
          
          var table = $('#approvalTable').tableSortable({
                data :[],
                columns,
                searchField: '#searchField',
                sorting: true,
                rowsPerPage: 15,
                pagination:true,
                tableWillMount: () => {
                    console.log('table will mount')
                    
                },
                tableDidMount: () => {
                    console.log('table did mount');
    
                    $('#spinner').hide();
                },
                tableWillUpdate: () => {
                    console.log('table will update')
                //  table.refresh();
                // onLoadTask();
                },
                tableDidUpdate: () => {
                console.log('table did update');
                 anchorClickFunctionalities();
                 additionalEditFunctionality();
                
                },
                tableWillUnmount: () => console.log('table will unmount'),
                tableDidUnmount: () => console.log('table did unmount'),
                onPaginationChange: function(nextPage, setPage) {
                    setPage(nextPage);
                },
            
            });
    
            /**************Table Sortable End ***********/
    
            $('#changeRows').on('change', function() {
            table.updateRowsPerPage(parseInt($(this).val(), 15));
            })
    
        /    $('#refresh').click(function() {
                table.refresh(true);
                onLoadTask();
            })
    
           $.ajax({
                url : '/procurement/getProcurementApprovalList',
                type:'get',
                data:{parentId:parentId},
                dataType: 'json'
           })
           .done((response) => {
               console.log('response Approval : '+JSON.stringify(response));
               table.setData(response, columns);
               anchorClickFunctionalities();
              
              
            })
          .fail((jqXHR, status, error) =>{
              console.log('jqXHR  : '+JSON.stringify(jqXHR));
              console.log('error  : '+error);
            })
        })

</script>